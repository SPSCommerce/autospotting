workspace:
  base: /go
  path: /src/github.com/cristim/autospotting

pipeline:
  build:
    image: golang:1.10.0-alpine
    commands:
      - apk add -U --no-cache ca-certificates git make zip
      - go get -v github.com/cristim/autospotting/...
      - FLAVOR=nightly CGO_ENABLED=0 make
      - make sps-package

  bdp_core_deploy:
    image: spscommerce/plugin-bdp-core
    environment:
      - VERSION=${DRONE_COMMIT}
      - REGION=us-east-1
      - BDP_FILE=.bdp
      - ZIP=lambda.zip
      - ACTION=deploy
      - ENVIRONMENT=dev
    commands:
      - python -u /build/plug.py
    when:
      event:
        - push
      branch:
        - master
